<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Business Card</title>
    <!-- Font Awesome for icons -->
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css"
      rel="stylesheet"
    />
    <!-- EmailJS Library -->
    <script type="text/javascript" src="https://cdn.emailjs.com/dist/email.min.js"></script>
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap"
      rel="stylesheet"
    />
    <style>
      /* Reset & Global Styles */
      * { margin: 0; padding: 0; box-sizing: border-box; }
      body {
        font-family: 'Poppins', sans-serif;
        background: linear-gradient(135deg, #cfd8dc, #eceff1);
        padding: 20px;
        min-height: 100vh;
        display: flex;
        flex-direction: column;
        align-items: center;
      }
      /* Card Container */
      .card-container {
        position: relative;
        width: 90%;
        max-width: 600px;
        background: #ffffff;
        border-radius: 20px;
        border: 2px solid transparent;
        border-image: linear-gradient(45deg, #1e90ff, #ff5722, #3f51b5) 1;
        box-shadow: 0 8px 30px rgba(0, 0, 0, 0.2);
        padding: 1.5rem;
        margin: 1rem auto;
        overflow: hidden;
      }
      /* Top Left Settings Icon */
      #styleControlsContainer {
        position: absolute;
        top: 10px;
        left: 10px;
        z-index: 10;
      }
      #styleButton {
        padding: 0.5rem;
        font-size: 1.2rem;
        border: none;
        background: none;
        cursor: pointer;
        color: blue;
      }
      #styleButton:hover { color: #1e90ff; }
      /* Top Right Share Icon */
      .top-icons {
        position: absolute;
        top: 10px;
        right: 10px;
        z-index: 10;
      }
      .top-share-icon {
        padding: 0.5rem;
        font-size: 1.2rem;
        border: none;
        background: none;
        cursor: pointer;
        color: blue;
      }
      .top-share-icon:hover { color: #1e90ff; }
      /* Mini Icons */
      .mini-icons {
        display: flex;
        justify-content: center;
        gap: 1rem;
        padding: 1rem;
        border-bottom: 2px solid #1e90ff;
      }
      .mini-icons .icon {
        font-size: 1.5rem;
        color: #333;
        cursor: pointer;
        border-radius: 50%;
        padding: 0.5rem;
        background: rgba(255,255,255,0.1);
        transition: transform 0.3s, box-shadow 0.3s;
      }
      .mini-icons .icon:hover {
        transform: translateY(-2px);
        box-shadow: 2px 2px 5px rgba(0,0,0,0.3);
      }
      /* Profile Section */
      .profile-section {
        display: flex;
        align-items: center;
        padding: 1rem;
        margin: 0.5rem;
        border-bottom: 2px solid #1e90ff;
      }
      .profile-image-container {
        width: 40%;
        display: flex;
        flex-direction: column;
        align-items: center;
        padding-right: 1rem;
      }
      .profile-image {
        width: 90px;
        height: 90px;
        border-radius: 50%;
        border: 2px solid rgba(245,245,245,0.9);
        object-fit: cover;
        transition: box-shadow 0.3s ease;
      }
      .profile-image:hover { box-shadow: 2px 2px 6px rgba(0,0,0,0.3); }
      .profile-name {
        color: #1e1e1e;
        margin-top: 0.5rem;
        font-size: 1.1rem;
        text-align: center;
      }
      .profile-info {
        width: 60%;
        padding-left: 1rem;
        display: flex;
        flex-direction: column;
        justify-content: center;
        text-align: center;
      }
      .contact-info {
        color: #333;
        margin: 0.3rem 0;
        font-size: 0.85rem;
        line-height: 1.4;
      }
      /* Business Info Section */
      .business-info-section {
        padding: 1rem;
        margin: 0.5rem 0;
        font-size: 0.9rem;
        line-height: 1.5;
        background: #ffffff;
        border: 1px solid #ddd;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        border-radius: 10px;
      }
      .business-info-content {
        text-align: center;
        font-weight: bold;
        color: #333;
        padding: 0.5rem;
      }
      /* --- Carousel Section (as in original carousel.html) --- */
      .carousel-wrapper {
        position: relative;
        width: 100%;
        margin-bottom: 20px;
        overflow: hidden;
      }
      .slides {
        display: flex;
        transition: transform 0.8s ease;
      }
      .slide {
        min-width: 100%;
        display: flex;
        justify-content: center;
        padding: 20px;
      }
      /* Increase carousel card width to fill available container space */
      .carousel-wrapper .card {
        width: 100%;
        max-width: 100%;
        border-radius: 12px;
        box-shadow: 0 8px 20px rgba(0,0,0,0.1);
        overflow: hidden;
        cursor: pointer;
        transition: transform 0.3s;
      }
      .carousel-wrapper .card:hover { transform: scale(1.02); }
      .card.card-1 { background: #fde2e2; color: #7a1d1d; }
      .card.card-2 { background: #e2f0cb; color: #355e03; }
      .card.card-3 { background: #d0e6a5; color: #3b4e1d; }
      .card.card-4 { background: #a8dadc; color: #084c61; }
      .card-content {
        display: flex;
        align-items: center;
        gap: 20px;
        padding: 16px;
      }
      .card-content.row { flex-direction: row; }
      .card-content.row-reverse { flex-direction: row-reverse; }
      .text-area { flex: 1; }
      .text-area h2, .text-area p { margin-bottom: 8px; word-wrap: break-word; }
      .text-area h2 { font-size: 1.8rem; font-weight: 600; }
      .text-area p { font-size: 1rem; line-height: 1.5; }
      .text-area [contenteditable="true"] {
        border: 1px dashed rgba(0,0,0,0.3);
        padding: 4px;
        border-radius: 4px;
      }
      .image-area { flex: 0 0 auto; max-width: 300px; }
      .image-area img {
        width: 100%;
        height: auto;
        object-fit: cover;
        border: 2px dashed #007bff;
        border-radius: 8px;
      }
      .upload-btn {
        margin-top: 8px;
        padding: 8px 16px;
        background: #007bff;
        color: #fff;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        font-size: 0.9rem;
      }
      input[type="file"] { display: none; }
      .dots {
        text-align: center;
        margin: 12px 0;
      }
      .dot {
        display: inline-block;
        width: 12px;
        height: 12px;
        margin: 0 5px;
        border-radius: 50%;
        background: #bbb;
        cursor: pointer;
        transition: background 0.3s;
      }
      .dot.active { background: #ff007f; }
      /* Mobile adjustments for carousel */
      @media (max-width: 600px) {
        .text-area h2 { font-size: 1.6rem; }
        .text-area p { font-size: 0.9rem; }
        .upload-btn, .dot { font-size: 0.8rem; }
        .card-content { flex-direction: column; }
        .image-area { max-width: 100%; }
      }
      /* --- End Carousel Section --- */
      /* Exclusive Offers Section */
      .action-buttons {
        display: grid;
        gap: 0.5rem;
        padding: 0.8rem;
      }
      .action-btn {
        text-align: center;
        text-decoration: none;
        padding: 0.6rem;
        border: none;
        border-radius: 10px;
        cursor: pointer;
        color: #fff;
        background: #1e90ff;
        transition: transform 0.3s, box-shadow 0.3s;
      }
      .action-btn:hover { transform: translateY(-2px); box-shadow: 2px 2px 5px rgba(0,0,0,0.3); }
      .social-links {
        display: flex;
        justify-content: center;
        gap: 1rem;
        padding: 1rem;
      }
      .social-icon {
        font-size: 1.5rem;
        color: #333;
        visibility: hidden;
        border-radius: 50%;
        padding: 0.5rem;
        background: rgba(255,255,255,0.1);
        text-decoration: none;
        transition: transform 0.3s, box-shadow 0.3s;
      }
      .social-icon:hover { color: #1e90ff; transform: translateY(-2px); box-shadow: 2px 2px 5px rgba(0,0,0,0.3); }
    </style>
  </head>
  <body>
    <div class="card-container" id="cardContainer">
      <!-- Top Left Settings Icon -->
      <div id="styleControlsContainer">
        <button id="styleButton" title="Settings">
          <i class="fas fa-cog"></i>
        </button>
      </div>
      <!-- Top Right Share Icon -->
      <div class="top-icons">
        <button class="top-share-icon" id="topShareIcon" title="Share">
          <i class="fas fa-share-alt"></i>
        </button>
      </div>
      <!-- Mini Icons -->
      <div class="mini-icons">
        <a id="miniCallButton" class="icon" title="Call">
          <i class="fas fa-phone"></i>
        </a>
        <a id="miniEmailButton" class="icon" title="Email">
          <i class="fas fa-envelope"></i>
        </a>
        <a id="miniWhatsappButton" class="icon" title="WhatsApp">
          <i class="fab fa-whatsapp"></i>
        </a>
        <a id="miniMapButton" class="icon" title="Open in Google Maps">
          <i class="fas fa-map-marker-alt"></i>
        </a>
      </div>
      <!-- Profile Section -->
      <div class="profile-section">
        <div class="profile-image-container">
          <img id="cardProfileImage" class="profile-image" alt="Profile" />
          <h3 class="profile-name" id="cardName"></h3>
        </div>
        <div class="profile-info">
          <p class="contact-info" id="cardBusinessName"></p>
          <p class="contact-info" id="cardAddress"></p>
          <p class="contact-info" id="cardPhone"></p>
          <p class="contact-info" id="cardEmail"></p>
        </div>
        <div class="connect-btn" id="connectButton" title="Save Contact">
          <i class="fas fa-save"></i>
        </div>
      </div>
      <!-- Business Info Section -->
      <div class="business-info-section">
        <div id="businessInfoContent"></div>
      </div>
      <!-- Carousel Section (as per original carousel.html) -->
      <div class="carousel-wrapper">
        <div class="slides">
          <!-- Slide 1 -->
          <div class="slide">
            <div class="card card-1" data-card="1" data-details="" data-img-pos="right">
              <div class="card-content row">
                <div class="text-area">
                  <h2 id="title1" contenteditable="true">Card 1 Title</h2>
                  <p id="desc1" contenteditable="true">Card 1 description goes here.</p>
                </div>
                <div class="image-area">
                  <img id="img1" src="https://via.placeholder.com/300x200.png?text=Upload+Image" alt="Image 1">
                  <button class="upload-btn" data-card="1">Upload Image</button>
                  <input type="file" class="file-input" data-card="1" accept="image/*">
                </div>
              </div>
            </div>
          </div>
          <!-- Slide 2 -->
          <div class="slide">
            <div class="card card-2" data-card="2" data-details="" data-img-pos="right">
              <div class="card-content row">
                <div class="text-area">
                  <h2 id="title2" contenteditable="true">Card 2 Title</h2>
                  <p id="desc2" contenteditable="true">Card 2 description goes here.</p>
                </div>
                <div class="image-area">
                  <img id="img2" src="https://via.placeholder.com/300x200.png?text=Upload+Image" alt="Image 2">
                  <button class="upload-btn" data-card="2">Upload Image</button>
                  <input type="file" class="file-input" data-card="2" accept="image/*">
                </div>
              </div>
            </div>
          </div>
          <!-- Slide 3 -->
          <div class="slide">
            <div class="card card-3" data-card="3" data-details="" data-img-pos="right">
              <div class="card-content row">
                <div class="text-area">
                  <h2 id="title3" contenteditable="true">Card 3 Title</h2>
                  <p id="desc3" contenteditable="true">Card 3 description goes here.</p>
                </div>
                <div class="image-area">
                  <img id="img3" src="https://via.placeholder.com/300x200.png?text=Upload+Image" alt="Image 3">
                  <button class="upload-btn" data-card="3">Upload Image</button>
                  <input type="file" class="file-input" data-card="3" accept="image/*">
                </div>
              </div>
            </div>
          </div>
          <!-- Slide 4 -->
          <div class="slide">
            <div class="card card-4" data-card="4" data-details="" data-img-pos="right">
              <div class="card-content row">
                <div class="text-area">
                  <h2 id="title4" contenteditable="true">Card 4 Title</h2>
                  <p id="desc4" contenteditable="true">Card 4 description goes here.</p>
                </div>
                <div class="image-area">
                  <img id="img4" src="https://via.placeholder.com/300x200.png?text=Upload+Image" alt="Image 4">
                  <button class="upload-btn" data-card="4">Upload Image</button>
                  <input type="file" class="file-input" data-card="4" accept="image/*">
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <!-- Dots Navigation -->
      <div class="dots">
        <span class="dot active" data-index="0"></span>
        <span class="dot" data-index="1"></span>
        <span class="dot" data-index="2"></span>
        <span class="dot" data-index="3"></span>
      </div>
      <!-- (Note: The Edit Card form has been removed from card.html) -->
      <!-- Exclusive Offers Section -->
      <div id="offersFlipCardSection"></div>
      <div class="action-buttons">
        <a id="callButton" class="action-btn contact-btn">Call</a>
        <a id="whatsappButton" class="action-btn contact-btn" style="background: #25d366;">WhatsApp</a>
        <a id="emailButton" class="action-btn contact-btn" style="background: var(--accent-color);">Email</a>
      </div>
      <div class="social-links">
        <a id="facebookButton" class="social-icon">
          <i class="fab fa-facebook-f"></i>
        </a>
        <a id="instagramButton" class="social-icon">
          <i class="fab fa-instagram"></i>
        </a>
        <a id="youtubeButton" class="social-icon">
          <i class="fab fa-youtube"></i>
        </a>
      </div>
    </div>
    
    <!-- Modal for Card Details -->
    <div class="modal" id="detailsModal">
      <div class="modal-content">
        <button class="close-btn">&times;</button>
        <div id="modalBody">
          <!-- Details will be injected here -->
        </div>
      </div>
    </div>
    
    <script>
      // ---------- Carousel Auto Slide & Dots Navigation ----------
      const slidesContainer = document.querySelector('.slides');
      const dots = document.querySelectorAll('.dot');
      let currentSlide = 0;
      const totalSlides = dots.length;
      
      function goToSlide(n) {
        currentSlide = (n + totalSlides) % totalSlides;
        slidesContainer.style.transform = 'translateX(-' + (currentSlide * 100) + '%)';
        dots.forEach(dot => dot.classList.remove('active'));
        dots[currentSlide].classList.add('active');
      }
      
      let slideInterval = setInterval(() => {
        goToSlide(currentSlide + 1);
      }, 5000);
      
      function pauseAutoSlide(duration = 30000) {
        clearInterval(slideInterval);
        setTimeout(() => {
          slideInterval = setInterval(() => {
            goToSlide(currentSlide + 1);
          }, 5000);
        }, duration);
      }
      
      dots.forEach(dot => {
        dot.addEventListener('click', function() {
          goToSlide(parseInt(this.getAttribute('data-index')));
          pauseAutoSlide();
        });
      });
      
      // ---------- Editable Text with Word Limits ----------
      const TITLE_LIMIT = 10;
      const DESC_LIMIT = 50;
      const DETAILS_LIMIT = 100;
      
      function enforceLimit(el, limit) {
        let words = el.textContent.trim().split(/\s+/).filter(word => word.length > 0);
        if (words.length > limit) {
          el.textContent = words.slice(0, limit).join(" ");
          placeCaretAtEnd(el);
        }
      }
      
      function placeCaretAtEnd(el) {
        el.focus();
        if (window.getSelection && document.createRange) {
          let range = document.createRange();
          range.selectNodeContents(el);
          range.collapse(false);
          let sel = window.getSelection();
          sel.removeAllRanges();
          sel.addRange(range);
        }
      }
      
      document.querySelectorAll('.text-area h2[contenteditable], .text-area p[contenteditable]').forEach(el => {
        el.addEventListener('input', function() {
          if(el.tagName === "H2") enforceLimit(el, TITLE_LIMIT);
          else enforceLimit(el, DESC_LIMIT);
        });
      });
      
      // ---------- Image Upload, Resize, and Imgur Upload ----------
      function resizeImage(file, maxWidth, fillColor, callback) {
        const reader = new FileReader();
        reader.onload = function(e) {
          const img = new Image();
          img.onload = function() {
            let width = img.width;
            let height = img.height;
            if (width > maxWidth) {
              height = height * (maxWidth / width);
              width = maxWidth;
            }
            const canvas = document.createElement('canvas');
            canvas.width = width;
            canvas.height = height;
            const ctx = canvas.getContext('2d');
            ctx.fillStyle = fillColor;
            ctx.fillRect(0, 0, width, height);
            ctx.drawImage(img, 0, 0, width, height);
            // Instead of returning the data URL directly,
            // upload it to Imgur using the provided Imgur ID.
            const dataUrl = canvas.toDataURL('image/jpeg', 0.8);
            uploadToImgur(dataUrl, callback);
          }
          img.src = e.target.result;
        }
        reader.readAsDataURL(file);
      }
      
      // Pseudo-function: Upload image to Imgur using provided Client/Album ID
      function uploadToImgur(dataUrl, callback) {
        // Replace '048d9400ce02b71' with your actual Imgur Client-ID if needed.
        fetch("https://api.imgur.com/3/image", {
          method: "POST",
          headers: {
            Authorization: "Client-ID 048d9400ce02b71",
            "Content-Type": "application/json"
          },
          body: JSON.stringify({
            image: dataUrl.split(",")[1],
            type: "base64"
            // Optionally include album or other parameters
          })
        })
        .then(response => response.json())
        .then(data => {
          if(data.success) {
            callback(data.data.link);
          } else {
            // If upload fails, fallback to data URL
            callback(dataUrl);
          }
        })
        .catch(() => callback(dataUrl));
      }
      
      document.querySelectorAll('.file-input').forEach(input => {
        input.addEventListener('change', function() {
          const cardNum = this.getAttribute('data-card');
          const file = this.files[0];
          if(file) {
            const card = document.querySelector('.card[data-card="' + cardNum + '"]');
            const fillColor = window.getComputedStyle(card).backgroundColor;
            resizeImage(file, 300, fillColor, function(resizedUrl) {
              const imageEl = document.getElementById('img' + cardNum);
              imageEl.src = resizedUrl;
              imageEl.style.border = 'none';
            });
          }
        });
      });
      
      document.querySelectorAll('.upload-btn').forEach(btn => {
        btn.addEventListener('click', function(e) {
          e.stopPropagation();
          const cardNum = this.getAttribute('data-card');
          document.querySelector('.file-input[data-card="' + cardNum + '"]').click();
        });
      });
      
      // ---------- Details Modal Functionality ----------
      const modal = document.getElementById('detailsModal');
      const modalBody = document.getElementById('modalBody');
      const closeBtn = document.querySelector('.close-btn');
      
      document.querySelectorAll('.card').forEach(card => {
        card.addEventListener('click', function(e) {
          if(e.target.classList.contains('upload-btn') || e.target.classList.contains('details-btn')) return;
          const detailsText = this.getAttribute('data-details') || "No details available.";
          modalBody.innerHTML = `<h3>Card ${this.getAttribute('data-card')} Details</h3><p>${detailsText}</p>`;
          modal.style.display = 'flex';
          pauseAutoSlide();
        });
      });
      
      document.querySelectorAll('.details-btn').forEach(btn => {
        btn.addEventListener('click', function(e) {
          e.stopPropagation();
          const card = this.closest('.card');
          const detailsText = card.getAttribute('data-details') || "No details available.";
          modalBody.innerHTML = `<h3>Card ${card.getAttribute('data-card')} Details</h3><p>${detailsText}</p>`;
          modal.style.display = 'flex';
          pauseAutoSlide();
        });
      });
      
      closeBtn.addEventListener('click', function() {
        modal.style.display = 'none';
      });
      
      window.addEventListener('click', function(e) {
        if(e.target === modal) modal.style.display = 'none';
      });
      
      // ---------- (Optional) Countdown Functionality ----------
      // If countdown is needed for any input fields, ensure the updateCountdown function is attached.
      function updateCountdown(fieldId, counterId, limit) {
        const field = document.getElementById(fieldId);
        const counter = document.getElementById(counterId);
        field.addEventListener('input', function() {
          let words = this.value.trim().split(/\s+/).filter(word => word.length > 0);
          let count = words.length;
          let remaining = limit - count;
          counter.textContent = remaining + " words remaining";
        });
      }
      
      // (If the edit form is removed, countdown may be unnecessary here.)
      
      // ---------- Load Stored Data ----------
      document.addEventListener("DOMContentLoaded", function () {
        "use strict";
        // Retrieve main form data from localStorage
        const storedData = localStorage.getItem("formData");
        const formData = storedData ? JSON.parse(storedData) : {};
        document.getElementById("cardProfileImage").src = formData.profileImage || "";
        document.getElementById("cardName").textContent = formData.name || "";
        document.getElementById("cardBusinessName").textContent = formData.businessName || "";
        document.getElementById("cardAddress").textContent = formData.address || "";
        document.getElementById("cardPhone").textContent = formData.phone || "";
        document.getElementById("cardEmail").textContent = formData.email || "";
        
        // Populate Business Info Section if available
        const businessInfo = formData.businessInfo || "";
        const paragraphs = businessInfo.split("\n").filter(p => p.trim() !== "");
        const businessInfoContainer = document.getElementById("businessInfoContent");
        businessInfoContainer.innerHTML = paragraphs.map(p => `<div class="business-info-content"><p>${p}</p></div>`).join("");
        
        // (No edit form data is processed here since the form has been removed.)
        
        // Social Links
        const socialLinks = {
          facebook: document.getElementById("facebookButton"),
          instagram: document.getElementById("instagramButton"),
          youtube: document.getElementById("youtubeButton")
        };
        Object.entries(socialLinks).forEach(([platform, element]) => {
          const url = formData[platform];
          if(url){
            element.href = url;
            element.style.visibility = "visible";
            element.target = "_blank";
          } else {
            element.style.visibility = "hidden";
          }
        });
      });
    </script>
  </body>
</html>
