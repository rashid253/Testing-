<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Business Card</title>
  <!-- Font Awesome for icons -->
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">
  <!-- Quill CSS for rich text editor -->
  <link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet">
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      background: #f4f4f4;
      margin: 0;
      padding: 20px;
    }
    .card-container {
      max-width: 800px;
      margin: auto;
      background: #fff;
      border-radius: 8px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.2);
      padding: 20px;
    }
    .business-info-section {
      background: #e0f7fa;
      padding: 15px;
      border-radius: 8px;
      max-height: 300px;
      overflow-y: auto;
      margin-bottom: 20px;
    }
    .offers-section {
      margin-top: 20px;
    }
    /* ===== Horizontal Scrolling Offer Cards ===== */
    .horizontal-container {
      overflow-x: auto;
      white-space: nowrap;
      padding-bottom: 10px;
    }
    .offer-card {
      display: inline-block;
      vertical-align: top;
      background: #007bff;
      color: #fff;
      padding: 10px;
      margin: 10px;
      border-radius: 8px;
      width: 200px;
      height: 150px;
      position: relative;
    }
    .offer-card button.detail-btn {
      position: absolute;
      bottom: 5px;
      left: 50%;
      transform: translateX(-50%);
      padding: 5px 10px;
      font-size: 12px;
      cursor: pointer;
    }
    /* ===== Tab-Based Offer Cards ===== */
    .tab-container {
      display: flex;
      border-bottom: 2px solid #007bff;
      margin-bottom: 10px;
    }
    .tab-btn {
      flex: 1;
      padding: 10px;
      text-align: center;
      cursor: pointer;
      background: #ccc;
    }
    .tab-btn.active {
      background: #007bff;
      color: #fff;
    }
    .tab-content {
      display: none;
      padding: 10px;
      border: 1px solid #007bff;
      border-top: none;
      border-radius: 0 0 8px 8px;
    }
    .tab-content.active {
      display: block;
    }
    /* ===== Expanding Card on Click ===== */
    .expanding-card {
      background: #28a745;
      color: #fff;
      padding: 10px;
      margin: 10px 0;
      border-radius: 8px;
      cursor: pointer;
      overflow: hidden;
      max-height: 60px;
      transition: max-height 0.3s ease;
      position: relative;
    }
    .expanding-card.expanded {
      max-height: 200px;
    }
    .expanding-card button.detail-btn {
      margin-top: 10px;
      padding: 5px 10px;
      font-size: 12px;
      cursor: pointer;
      position: absolute;
      bottom: 5px;
      left: 50%;
      transform: translateX(-50%);
    }
    /* ===== Accordion Offers ===== */
    .accordion {
      width: 100%;
      margin: 10px 0;
    }
    .accordion-item {
      border-bottom: 1px solid #ddd;
    }
    .accordion-header {
      background: #007bff;
      color: #fff;
      padding: 10px;
      cursor: pointer;
      font-size: 16px;
    }
    .accordion-content {
      max-height: 0;
      overflow: hidden;
      background: #f9f9f9;
      transition: max-height 0.3s ease-out, padding 0.3s ease;
      padding: 0 10px;
    }
    .accordion-item.active .accordion-content {
      max-height: 150px;
      padding: 10px;
    }
    /* ===== Modal Popup Offers ===== */
    /* In modal style the offer cards simply trigger the modal */
    /* (They are rendered similar to horizontal cards) */
    /* ===== Detail Modal for Offer Editing ===== */
    .modal {
      display: none;
      position: fixed;
      z-index: 1000;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.5);
      justify-content: center;
      align-items: center;
    }
    .modal-content {
      background: #fff;
      padding: 20px;
      border-radius: 8px;
      width: 90%;
      max-width: 500px;
      position: relative;
    }
    .modal-content .close-modal {
      position: absolute;
      top: 10px;
      right: 15px;
      font-size: 18px;
      cursor: pointer;
    }
    /* ===== Offer Detail Editor and File Upload ===== */
    #offerDetailEditor {
      height: 150px;
      border: 1px solid #ccc;
      border-radius: 4px;
      margin-bottom: 10px;
    }
    #offerImagePreview {
      width: 75px;
      height: 75px;
      border: 1px solid #ccc;
      display: none;
      object-fit: cover;
      margin-bottom: 10px;
    }
  </style>
</head>
<body>
  <div class="card-container">
    <h2>My Business Card</h2>
    <div class="business-info-section">
      <h3>Business Info</h3>
      <div id="businessInfoContent"></div>
    </div>
    <div class="offers-section" id="offersSection">
      <h3>Hot Offers</h3>
      <!-- Offers will be rendered dynamically here -->
    </div>
  </div>

  <!-- Offer Detail Modal (for editing offer details) -->
  <div id="offerDetailModal" class="modal">
    <div class="modal-content">
      <span class="close-modal" onclick="closeOfferDetailModal()">&times;</span>
      <h3>Edit Offer Details</h3>
      <!-- Rich Text Editor -->
      <div id="offerDetailEditor"></div>
      <!-- File Upload -->
      <input type="file" id="offerDetailFile" accept="image/*">
      <img id="offerImagePreview" alt="Offer Image">
      <br>
      <button type="button" onclick="saveOfferDetail()">Save Details</button>
      <p id="professionalSentence" style="font-style: italic; margin-top:10px; color:#555;">
        Experience our exclusive offers by visiting our store today!
      </p>
    </div>
  </div>

  <!-- External Scripts -->
  <script src="https://cdn.quilljs.com/1.3.6/quill.js"></script>
  <script>
    // Load saved data from localStorage
    var formData = JSON.parse(localStorage.getItem("formData")) || {};
    var offers = formData.offers || [];
    // offerStyle should be one of: "horizontal", "tab", "expanding", "accordion", or "modal"
    var offerStyle = formData.offerStyle || "horizontal";
    // For offer details, if not available initialize an array of empty strings
    var offersDetails = formData.offersDetails || Array(offers.length).fill("");
    var currentOfferIndex = -1; // For tracking which offer is being edited

    // Render business info from formData
    document.getElementById("businessInfoContent").innerHTML = formData.businessInfo || "<p>No business info provided.</p>";

    // Initialize Quill for offer details in modal
    var offerEditor = new Quill('#offerDetailEditor', { theme: 'snow' });

    // Function to render offers based on selected style
    function renderOffers() {
      var container = document.getElementById("offersSection");
      // Clear any previous content (keeping heading)
      container.innerHTML = "<h3>Hot Offers</h3>";
      if (offers.length === 0) {
        container.innerHTML += "<p>No offers available.</p>";
        return;
      }
      
      if (offerStyle === "horizontal") {
        var horiz = document.createElement("div");
        horiz.className = "horizontal-container";
        offers.forEach(function(offer, index) {
          var card = document.createElement("div");
          card.className = "offer-card";
          card.innerHTML = "<h4>" + offer + "</h4>" +
                           "<button class='detail-btn' onclick='openOfferDetail(" + index + ")'>Details</button>";
          horiz.appendChild(card);
        });
        container.appendChild(horiz);
      } else if (offerStyle === "tab") {
        var tabContainer = document.createElement("div");
        tabContainer.className = "tab-container";
        var contentContainer = document.createElement("div");
        offers.forEach(function(offer, index) {
          var tabBtn = document.createElement("div");
          tabBtn.className = "tab-btn";
          tabBtn.innerText = "Offer " + (index+1);
          tabBtn.onclick = function() { setActiveTab(index); };
          tabContainer.appendChild(tabBtn);
          
          var tabContent = document.createElement("div");
          tabContent.className = "tab-content";
          tabContent.id = "tabContent" + index;
          tabContent.innerHTML = "<h4>" + offer + "</h4>" +
                                 "<button class='detail-btn' onclick='openOfferDetail(" + index + ")'>Details</button>";
          contentContainer.appendChild(tabContent);
        });
        container.appendChild(tabContainer);
        container.appendChild(contentContainer);
        setActiveTab(0);
      } else if (offerStyle === "expanding") {
        offers.forEach(function(offer, index) {
          var expCard = document.createElement("div");
          expCard.className = "expanding-card";
          expCard.onclick = function() { this.classList.toggle("expanded"); };
          // Include a detail button that stops propagation
          expCard.innerHTML = "<h4>" + offer + "</h4>" +
                              "<button class='detail-btn' onclick='openOfferDetail(" + index + "); event.stopPropagation();'>Details</button>";
          container.appendChild(expCard);
        });
      } else if (offerStyle === "accordion") {
        var accordion = document.createElement("div");
        accordion.className = "accordion";
        offers.forEach(function(offer, index) {
          var item = document.createElement("div");
          item.className = "accordion-item";
          item.innerHTML = "<div class='accordion-header' onclick='toggleAccordion(this)'>Offer " + (index+1) + ": " + offer + "</div>" +
                           "<div class='accordion-content'><button class='detail-btn' onclick='openOfferDetail(" + index + ")'>Details</button></div>";
          accordion.appendChild(item);
        });
        container.appendChild(accordion);
      } else if (offerStyle === "modal") {
        // For modal style, the card itself opens the modal on click
        offers.forEach(function(offer, index) {
          var card = document.createElement("div");
          card.className = "offer-card";
          card.style.cursor = "pointer";
          card.onclick = function() { openOfferDetail(index); };
          card.innerHTML = "<h4>" + offer + "</h4>";
          container.appendChild(card);
        });
      }
    }
    
    // Tab function
    function setActiveTab(index) {
      var tabButtons = document.querySelectorAll(".tab-btn");
      var tabContents = document.querySelectorAll(".tab-content");
      tabButtons.forEach(function(btn, i) {
        btn.classList.toggle("active", i === index);
      });
      tabContents.forEach(function(content, i) {
        content.classList.toggle("active", i === index);
      });
    }
    
    // Accordion toggle
    function toggleAccordion(header) {
      var item = header.parentElement;
      item.classList.toggle("active");
    }
    
    // Open the offer detail modal for a given offer index
    function openOfferDetail(index) {
      currentOfferIndex = index;
      // Load existing detail text (if any)
      var detailText = offersDetails[index] || "";
      offerEditor.root.innerHTML = detailText;
      // Clear file input and image preview
      document.getElementById("offerDetailFile").value = "";
      var imgPrev = document.getElementById("offerImagePreview");
      imgPrev.src = "";
      imgPrev.style.display = "none";
      // Open modal
      document.getElementById("offerDetailModal").style.display = "flex";
    }
    
    // Close modal
    function closeOfferDetailModal() {
      document.getElementById("offerDetailModal").style.display = "none";
    }
    
    // Save offer detail from modal
    function saveOfferDetail() {
      var detailContent = offerEditor.root.innerHTML;
      // Append professional sentence if not already included
      var proSentence = "Experience our exclusive offers by visiting our store today!";
      if (!detailContent.includes(proSentence)) {
        detailContent += "<p style='font-style: italic; color:#555;'>" + proSentence + "</p>";
      }
      offersDetails[currentOfferIndex] = detailContent;
      // Save back to formData and localStorage
      formData.offersDetails = offersDetails;
      localStorage.setItem("formData", JSON.stringify(formData));
      closeOfferDetailModal();
      // Optionally, re-render offers to indicate details exist (if desired)
      renderOffers();
    }
    
    // File upload change: display preview if image is uploaded
    document.getElementById("offerDetailFile").addEventListener("change", function(event) {
      var file = event.target.files[0];
      if (file) {
        var reader = new FileReader();
        reader.onload = function(e) {
          var imgPrev = document.getElementById("offerImagePreview");
          imgPrev.src = e.target.result;
          imgPrev.style.display = "block";
        };
        reader.readAsDataURL(file);
      }
    });
    
    // Initial render of offers on page load
    renderOffers();
  </script>
</body>
</html>
